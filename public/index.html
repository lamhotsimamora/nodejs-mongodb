<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Example MongoDB & Express</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdn.metroui.org.ua/v4/css/metro-all.min.css">
    <script src="https://kit.fontawesome.com/2d224c69d1.js" crossorigin="anonymous"></script>
    <script src="https://cdn.metroui.org.ua/v4/js/metro.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <aside class="sidebar pos-absolute z-2" data-role="sidebar" data-toggle="#sidebar-toggle-2">
        <div class="sidebar-header" data-image="public/sb-bg-1.jpg">
            <div class="avatar">
                <img src="public/me.jpg" data-email="lamhotsimamora36@gmail.com">
            </div>
            <span class="title fg-white">Example MongoDB & Express</span>
            <span class="subtitle fg-white"> 2022Â©Lamhot Simamora</span>
        </div>
        <ul class="sidebar-menu">
            <li><a href="."><span class="mif-home icon"></span>Home</a></li>
            <li><a href="./add-data"><span class="mif-add icon"></span>Add Data</a></li>
        </ul>
    </aside>

    <div class="h-100 p-ab">
        <button class="button square pos-absolute pos-top-left" id="sidebar-toggle-2">
            <span class="mif-menu"></span>
        </button>
    </div>

    <div id="table-data" class="container-fluid">
        <!-- content here -->

        <button @click="goToAdd" class="button primary">+ Add</button>
        <hr>
        <table class="table">
            <thead>
                <tr>
                    <!-- <th>#</th> -->
                    <th>Username</th>
                    <th>Email</th>
                    <th>@</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="d in data_user">
                    <!-- <td>{{ d._id }}</td> -->
                    <td>{{ d.username }}</td>
                    <td>{{ d.email }}</td>
                    <td>
                        <button @click="deleteData(d.username)" class="button alert">x</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</body>

<script>
    var _TOKEN_ = 'kKKl3NKuXfb6kVkfh61fVafm5Ds1Y3jydxMZAOC';


    var table_data = new Vue({
        el: '#table-data',
        data: {
            data_user: null
        },
        methods: {
            goToAdd: function () {
                window.location.href = "./add-data";
            },
            deleteData: function (username) {
                var data = this;
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        axios({
                            method: 'post',
                            url: '/api/delete-data',
                            data: {
                                _token: _TOKEN_,
                                _username: username
                            }
                        }).then(function (response) {
                            var result = (response.data.result);
                            if (result) {
                            Swal.fire(
                                    'Deleted!',
                                    'Your data has been deleted.',
                                    'success'
                                )
                            }
                            data.loadData()
                        })
                            .catch(function (error) {
                                console.log(error);
                            });

                    }
                })


            },
            loadData: function () {
                this.data_user = null;
                var data = this;
                axios({
                    method: 'post',
                    url: '/api/get-all-data',
                    data: {
                        _token: _TOKEN_
                    }
                }).then(function (response) {
                    var obj = (response.data);

                    data.data_user = obj;
                })
                    .catch(function (error) {
                        console.log(error);
                    });
            }
        },
        mounted() {
            this.loadData();
        },
    })
</script>

</html>